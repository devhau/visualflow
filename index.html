<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css"
    integrity="sha256-h20CPZ0QyXlBuAw7A+KluUYx/3pK+c7lYEpqLTlxjYQ=" crossorigin="anonymous" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="./dist/workerflow.css" />
  <script src="./dist/workerflow.min.js"></script>
</head>

<body>
  <button onclick="onExport()">Export</button>
  <button onclick="onNew()">New</button>
  <button onclick="onLoad()">Load</button>
  <textarea id="text"></textarea>
  <textarea id="share"></textarea>
  <div id="flow"></div>
</body>
<script>
  let optionFlow = {
    control: {
      Node1: {
        key: "node_begin",
        name: '<i class="fas fa-play"></i> Begin</span>',
        html: '<div><i class="fas fa-play"></i> Node Begin</div>',
        script: `console.log(node)`,
        output: 1,
        input: 0,
        onlyNode: true
      },
      Node2: {
        key: "node_end",
        name: '<i class="fas fa-stop"></i> End',
        html: '<div><i class="fas fa-stop"></i> Node End</div>',
        output: 0,
        onlyNode: true
      },
      Node3: {
        key: "node_if",
        name: '<i class="fas fa-equals"></i> If',
        html: '<div>condition:<br/><input node:model="condition"/></div>',
        output: 2
      },
      Node4: {
        key: "node_note",
        name: '<i class="fal fa-comment-alt"></i> Note',
        html: '<div><textarea node:model="note"></textarea></div>',
      }
    }
  }
  let flow = (new workerflow(document.getElementById("flow"), optionFlow));
  let text = document.getElementById('text');
  let share = document.getElementById('share');
  try {
    flow.load(JSON.parse(atob(window.location.search.substring(1))));

  } catch {

  }

  function onNew() {
    flow.new();
  }

  function onLoad() {
    let data = JSON.parse(text.value);
    flow.load(data);
  }

  function onExport() {
    let data = flow.toJson();
    text.value = JSON.stringify(data);
    share.value = window.location.href.split('?')[0] + `?` + btoa(text.value);
  }

</script>

</html>
