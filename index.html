<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css"
    integrity="sha256-h20CPZ0QyXlBuAw7A+KluUYx/3pK+c7lYEpqLTlxjYQ=" crossorigin="anonymous" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="./dist/workerflow.css" />
  <script src="./dist/workerflow.min.js"></script>
</head>

<body>
  <button onclick="onExport()">Export</button>
  <button onclick="onNew()">New</button>
  <button onclick="onLoad()">Load</button>
  <textarea id="text"></textarea>
  <textarea id="share"></textarea>
  <div id="flow"></div>
</body>
<script>
  let optionFlow = {
    control: {
      node_begin: {
        key: "node_begin",
        name: '<i class="fas fa-play"></i> Begin</span>',
        html: '<div><i class="fas fa-play"></i> Node Begin</div>',

        output: 1,
        input: 0,
        onlyNode: true
      },
      node_end: {
        key: "node_end",
        name: '<i class="fas fa-stop"></i> End',
        html: '<div><i class="fas fa-stop"></i> Node End</div>',
        output: 0,
        onlyNode: true
      },
      node_if: {
        key: "node_if",
        name: '<i class="fas fa-equals"></i> If',
        html: '<div>condition:<br/><input node:model="condition"/></div>',
        script: `
        node.option.output = parseInt(node.data.Get('condition'));
        if(node.option.output>4){
          node.option.html='<div>condition:<br/><input node:model="condition1"/><input node:model="condition2"/><input node:model="condition"/></div>'
        }else{
          node.option.html='<div>condition:<br/><input node:model="condition"/></div>';
        }
        node.ReUIT();
        node.on('dataChange',function(e,sender){
          if(node.key='condition'){
            node.option.output = parseInt(e.value);
            if(node.option.output>4){
              node.option.html='<div>condition:<br/><input node:model="condition1"/><input node:model="condition2"/><input node:model="condition"/></div>'
            }else{
              node.option.html='<div>condition:<br/><input node:model="condition"/></div>';
            }
            node.ReUIT();
          }
        })`,
        output: 2
      },
      node_note: {
        key: "node_note",
        name: '<i class="fas fa-comment-alt"></i> Note',
        html: '<div><textarea node:model="note"></textarea></div>',
      }
    }
  }
  let flow = (new workerflow(document.getElementById("flow"), optionFlow));
  let text = document.getElementById('text');
  let share = document.getElementById('share');
  try {
    flow.load(JSON.parse(atob(window.location.search.substring(1))));
    onExport();
  } catch {

  }

  function onNew() {
    flow.new();
  }

  function onLoad() {
    let data = JSON.parse(text.value);
    flow.load(data);
  }

  function onExport() {
    let data = flow.toJson();
    text.value = JSON.stringify(data);
    share.value = window.location.href.split('?')[0] + `?` + btoa(text.value);
  }

</script>

</html>
